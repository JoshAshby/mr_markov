#!/usr/bin/env ruby

require_relative '../mr_markov'
require 'telegram/bot'
require 'excon'

Telegram::Bot.configure do |config|
  config.adapter = :excon
end

config = AshFrame.config_for(:telegram).symbolize_keys

Telegram::Bot::Client.run config.delete(:token), logger: MrMarkov.logger, **config do |bot|
  bot.logger.info 'Bot has been started'

  bot.listen do |message|
    MessageHandlingBlock.call_async message: message
  end
end
